<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Employee Portal - Bar918</title>
</head>
<body style="background:transparent;font-family:Arial;text-align:center;color:#fff;">
<h2>Bar918 Employee Portal</h2>
<p>View bookings, mark as seated/finished, and close off tables.</p>

<div>
  <label>Select Date: </label>
  <input type="date" id="dateSelect" />
  <button onclick="loadBookings()">Load Bookings</button>
</div>

<table border="1" style="margin:auto;margin-top:20px;width:90%;border-collapse:collapse;color:#fff;">
  <thead>
    <tr>
      <th>Table</th>
      <th>Name</th>
      <th>Date</th>
      <th>Time</th>
      <th>Contact</th>
      <th>Notes</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="bookingList"></tbody>
</table>

<script>
const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbxALplsL1YhvjozZcJrd68-wZ_J8lG0IavP-B9xY26LD8ug7KnTAF5_gOcC3S5Ktp5S/exec";

async function loadBookings() {
  const date = document.getElementById("dateSelect").value;
  const tbody = document.getElementById("bookingList");
  tbody.innerHTML = "<tr><td colspan='8'>Loading...</td></tr>";

  try {
    const response = await fetch(WEBHOOK_URL);
    const data = await response.json();
    const filtered = data.filter(row => row.Date === date);

    tbody.innerHTML = "";
    if (filtered.length === 0) {
      tbody.innerHTML = "<tr><td colspan='8'>No bookings for this date.</td></tr>";
      return;
    }

    filtered.forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.Table}</td>
        <td>${row.Name}</td>
        <td>${row.Date}</td>
        <td>${row.Time}</td>
        <td>${row.Contact}</td>
        <td>${row.Notes || ''}</td>
        <td>${row.Status}</td>
        <td>
          <button onclick="updateStatus('${row.Table}','Seated')">Seated</button>
          <button onclick="updateStatus('${row.Table}','Finished')">Finished</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error(err);
    tbody.innerHTML = "<tr><td colspan='8'>Error loading bookings.</td></tr>";
  }
}

async function updateStatus(table, status) {
  try {
    await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify({ action: "update", table, status }),
    });
    alert(`Table ${table} marked as ${status}`);
    loadBookings();
  } catch (err) {
    console.error("Error updating status", err);
  }
}
</script>
</body>
</html>
