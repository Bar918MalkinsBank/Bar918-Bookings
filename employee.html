<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bar918 Employee Portal</title>
  <style>
    body { font-family: Poppins, sans-serif; background:#faf9f6; color:#012C4E; padding:20px; text-align:center; }
    table { width:95%; margin:auto; border-collapse:collapse; background:white; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
    th,td { padding:10px; border-bottom:1px solid #eee; text-align:left; }
    th { background:#012C4E; color:white; }
    select { border-radius:6px; padding:4px; }
    button { background:#012C4E; color:white; border:none; border-radius:8px; padding:10px 16px; font-weight:bold; cursor:pointer; }
    .layout { display:flex; justify-content:center; gap:60px; flex-wrap:wrap; margin-top:30px; }
    .divider { height:360px; width:6px; background:#5C2C06; border-radius:3px; align-self:center; }
    .section { display:grid; grid-template-columns:repeat(3,1fr); gap:24px; }
    .snug { display:flex; justify-content:center; gap:24px; margin-top:30px; }
    .table-btn { width:100px; height:70px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; transition:0.2s; background:#EAD292; }
    .booked { background:#FFB3B3; }
    .seated { background:#B3C6FF; }
  </style>
</head>
<body>
  <h1>Bar918 Employee Portal</h1>
  <input type="date" id="datePicker" />
  <table>
    <thead>
      <tr><th>Table</th><th>Name</th><th>Time</th><th>Contact</th><th>Baby Seat</th><th>Requests</th><th>Status</th></tr>
    </thead>
    <tbody id="bookingsBody"><tr><td colspan="7">Loading...</td></tr></tbody>
  </table>

  <div class="layout">
    <div class="section" id="left-section">
      <button class="table-btn" data-table="7">7</button><button class="table-btn" data-table="8">8</button><button class="table-btn" data-table="9">9</button>
      <button class="table-btn" data-table="10">10</button><button class="table-btn" data-table="11">11</button><button class="table-btn" data-table="12">12</button>
      <button class="table-btn" data-table="13">13</button><button class="table-btn" data-table="14">14</button><button class="table-btn" data-table="15">15</button>
    </div>
    <div class="divider"></div>
    <div class="section" id="right-section">
      <button class="table-btn" data-table="1">1</button><button class="table-btn" data-table="2">2</button><button class="table-btn" data-table="3">3</button>
      <button class="table-btn" data-table="4">4</button><button class="table-btn" data-table="5">5</button><button class="table-btn" data-table="6">6</button>
    </div>
  </div>
  <div class="snug">
    <button class="table-btn" data-table="S1">Snug 1</button><button class="table-btn" data-table="S2">Snug 2</button><button class="table-btn" data-table="S3">Snug 3</button>
  </div>

  <script>
    const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbxALplsL1YhvjozZcJrd68-wZ_J8lG0IavP-B9xY26LD8ug7KnTAF5_gOcC3S5Ktp5S/exec';
    const datePicker = document.getElementById('datePicker');
    const bookingsBody = document.getElementById('bookingsBody');
    datePicker.valueAsDate = new Date();

    async function fetchBookings() {
      const res = await fetch(`${WEBHOOK_URL}?date=${datePicker.value}`);
      const data = await res.json();
      bookingsBody.innerHTML = '';
      const tables = document.querySelectorAll('.table-btn');
      tables.forEach(t => t.className = 'table-btn');

      if (!data || !data.length) {
        bookingsBody.innerHTML = '<tr><td colspan="7">No bookings today</td></tr>';
        return;
      }

      data.forEach(b => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${b.table}</td>
          <td>${b.name}</td>
          <td>${b.time}</td>
          <td>${b.phone}<br>${b.email}</td>
          <td>${b.babySeat}</td>
          <td>${b.specialRequests || ''}</td>
          <td>
            <select class="status" data-table="${b.table}">
              <option value="Booked" ${b.status === 'Booked' ? 'selected' : ''}>Booked</option>
              <option value="Seated" ${b.status === 'Seated' ? 'selected' : ''}>Seated</option>
              <option value="Finished" ${b.status === 'Finished' ? 'selected' : ''}>Finished</option>
            </select>
          </td>`;
        bookingsBody.appendChild(row);

        const btn = document.querySelector(`[data-table="${b.table}"]`);
        if (btn) btn.classList.add(b.status.toLowerCase());
      });
    }

    document.addEventListener('change', async (e) => {
      if (e.target.classList.contains('status')) {
        const status = e.target.value;
        const table = e.target.dataset.table;
        await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ updateStatus: true, table, status, date: datePicker.value })
        });
        fetchBookings();
      }
    });

    datePicker.addEventListener('change', fetchBookings);
    fetchBookings();
  </script>
</body>
</html>
