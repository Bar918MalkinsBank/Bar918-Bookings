function doGet(e) {
  const ss = SpreadsheetApp.openById('1-FSwF_skvrpnzhH3KJoqEuuYC5BHZzSJF-yyqJt5kfc');
  const sheet = ss.getSheetByName('Bookings');
  const date = e.parameter.date;
  const data = sheet.getDataRange().getValues();
  const headers = data.shift();
  const bookings = data.filter(row => row[headers.indexOf('Date')] === date)
    .map(row => Object.fromEntries(headers.map((h, i) => [h, row[i]])));

  return ContentService
    .createTextOutput(JSON.stringify(bookings))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  const ss = SpreadsheetApp.openById('1-FSwF_skvrpnzhH3KJoqEuuYC5BHZzSJF-yyqJt5kfc');
  const sheet = ss.getSheetByName('Bookings');
  const closedSheet = ss.getSheetByName('ClosedDates');
  const settings = ss.getSheetByName('Settings');
  const data = JSON.parse(e.postData.contents);

  // Handle status update
  if (data.updateStatus) {
    const range = sheet.getDataRange().getValues();
    const headers = range.shift();
    const dateCol = headers.indexOf('Date');
    const tableCol = headers.indexOf('Table');
    const statusCol = headers.indexOf('Status');

    for (let i = 0; i < range.length; i++) {
      if (range[i][dateCol] === data.date && range[i][tableCol] === data.table) {
        sheet.getRange(i + 2, statusCol + 1).setValue(data.status);
        break;
      }
    }
    return ContentService.createTextOutput('Status updated');
  }

  const booking = [
    data.name,
    data.email,
    data.phone,
    data.table,
    data.seats,
    data.babySeat,
    data.specialRequests,
    data.date,
    data.time,
    'Booked'
  ];

  sheet.appendRow(booking);
  return ContentService.createTextOutput('Booking saved');
}
