<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bar918 Employee Portal</title>
<style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #f9f9f9;
    padding: 20px;
    color: #012C4E;
  }

  h2 { text-align: center; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }

  th, td {
    padding: 8px;
    border: 1px solid #ddd;
    text-align: left;
  }

  th {
    background-color: #012C4E;
    color: #fff;
  }

  .status {
    cursor: pointer;
    padding: 5px 10px;
    border-radius: 5px;
  }

  .booked { background: #d8b86c; color: #012C4E; }
  .seated { background: #4caf50; color: #fff; }
  .finished { background: #9e9e9e; color: #fff; }

  button {
    background: #012C4E;
    color: #EAD292;
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  button:hover {
    background: #EAD292;
    color: #012C4E;
  }
</style>
</head>
<body>
<h2>Bar918 Booking Management</h2>
<button onclick="refreshBookings()">Refresh</button>
<table id="bookingTable">
  <thead>
    <tr>
      <th>Date</th>
      <th>Name</th>
      <th>Phone</th>
      <th>Email</th>
      <th>Table</th>
      <th>Time</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbxALplsL1YhvjozZcJrd68-wZ_J8lG0IavP-B9xY26LD8ug7KnTAF5_gOcC3S5Ktp5S/exec';

async function refreshBookings() {
  const res = await fetch(WEBHOOK_URL + '?action=getAll');
  const text = await res.text();
  const data = JSON.parse(text);
  const tbody = document.querySelector('#bookingTable tbody');
  tbody.innerHTML = '';

  data.bookings.forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.date}</td>
      <td>${r.name}</td>
      <td>${r.phone}</td>
      <td>${r.email}</td>
      <td>${r.table}</td>
      <td>${r.time}</td>
      <td><span class="status ${r.status.toLowerCase()}" onclick="toggleStatus('${r.id}', '${r.status}')">${r.status}</span></td>
    `;
    tbody.appendChild(tr);
  });
}

async function toggleStatus(id, status) {
  const next = status === 'Booked' ? 'Seated' : status === 'Seated' ? 'Finished' : 'Booked';
  await fetch(WEBHOOK_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
    body: JSON.stringify({ action: 'updateStatus', id, status: next })
  });
  refreshBookings();
}

refreshBookings();
</script>
</body>
</html>
