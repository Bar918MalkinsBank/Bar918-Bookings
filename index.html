<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bar918 Table Booking</title>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  emailjs.init("aypCqsVVHRqzqReCk");
</script>

<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: transparent;
    color: #012C4E;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 10px;
    font-size: 2rem;
    color: #012C4E;
  }

  .booking-container {
    max-width: 900px;
    margin: 0 auto;
    background: rgba(255,255,255,0.6);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(5px);
  }

  .table-layout {
    display: flex;
    justify-content: space-between;
    position: relative;
    margin: 30px 0;
  }

  /* Divider */
  .divider {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 50%;
    width: 3px;
    background: #4B2E05;
    border-radius: 2px;
    transform: translateX(-50%);
  }

  /* Sections */
  .left-section, .right-section {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    flex: 1;
    padding: 10px;
  }

  .snug-section {
    display: flex;
    justify-content: center;
    margin-top: 25px;
    gap: 20px;
  }

  /* Tables */
  .table {
    background: #EAD292;
    color: #012C4E;
    border-radius: 10px;
    padding: 15px 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    border: 2px solid transparent;
  }

  .table:hover {
    transform: scale(1.05);
    border-color: #012C4E;
  }

  .table.selected {
    background: #012C4E;
    color: white;
    border-color: #EAD292;
  }

  .table.booked {
    background: #bbb;
    cursor: not-allowed;
    color: white;
    border-color: #777;
  }

  .table small {
    display: block;
    font-weight: normal;
    font-size: 0.85em;
  }

  /* Form */
  form {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 15px;
  }

  label {
    font-weight: 600;
  }

  input, select, textarea, button {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1em;
    width: 100%;
  }

  button {
    background: #012C4E;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  button:hover {
    background: #EAD292;
    color: #012C4E;
  }
</style>
</head>

<body>
  <div class="booking-container">
    <h1>Book a Table</h1>

    <div class="table-layout">
      <div class="left-section" id="leftTables"></div>
      <div class="divider"></div>
      <div class="right-section" id="rightTables"></div>
    </div>

    <div class="snug-section" id="snugTables"></div>

    <form id="bookingForm">
      <label>Name</label>
      <input type="text" id="name" required>

      <label>Email</label>
      <input type="email" id="email" required>

      <label>Phone Number</label>
      <input type="tel" id="phone" required>

      <label>Date</label>
      <input type="date" id="date" required>

      <label>Time</label>
      <input type="time" id="time" min="10:00" max="20:00" required>

      <label>Baby Seat?</label>
      <select id="babySeat">
        <option value="No">No</option>
        <option value="Yes">Yes</option>
      </select>

      <label>Special Requests</label>
      <textarea id="specialRequests" rows="3"></textarea>

      <input type="hidden" id="table" required>

      <button type="submit">Confirm Booking</button>
    </form>
  </div>

<script>
const leftTables = [
  {id: 7, seats: 4}, {id: 8, seats: 4}, {id: 9, seats: 4},
  {id: 10, seats: 4}, {id: 11, seats: 4}, {id: 12, seats: 4},
  {id: 13, seats: 4}, {id: 14, seats: 6}, {id: 15, seats: 4}
];

const rightTables = [
  {id: 1, seats: 4}, {id: 2, seats: 6}, {id: 3, seats: 4},
  {id: 4, seats: 4}, {id: 5, seats: 4}, {id: 6, seats: 6}
];

const snugTables = [
  {id: 'S1', seats: 2}, {id: 'S2', seats: 2}, {id: 'S3', seats: 2}
];

function renderTables() {
  const left = document.getElementById('leftTables');
  const right = document.getElementById('rightTables');
  const snug = document.getElementById('snugTables');

  left.innerHTML = leftTables.map(t => `
    <div class="table" data-id="${t.id}" data-seats="${t.seats}">
      Table ${t.id}
      <small>${t.seats} seats</small>
    </div>`).join('');

  right.innerHTML = rightTables.map(t => `
    <div class="table" data-id="${t.id}" data-seats="${t.seats}">
      Table ${t.id}
      <small>${t.seats} seats</small>
    </div>`).join('');

  snug.innerHTML = snugTables.map(t => `
    <div class="table" data-id="${t.id}" data-seats="${t.seats}">
      ${t.id}
      <small>${t.seats} seats</small>
    </div>`).join('');

  document.querySelectorAll('.table').forEach(btn => {
    btn.addEventListener('click', function() {
      if (this.classList.contains('booked')) return;
      document.querySelectorAll('.table').forEach(t => t.classList.remove('selected'));
      this.classList.add('selected');
      document.getElementById('table').value = this.dataset.id;
    });
  });
}

renderTables();

// Handle booking submission
document.getElementById('bookingForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const formData = {
    name: document.getElementById('name').value.trim(),
    email: document.getElementById('email').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    table: document.getElementById('table').value,
    seats: document.querySelector('.table.selected')?.dataset.seats || '',
    babySeat: document.getElementById('babySeat').value,
    specialRequests: document.getElementById('specialRequests').value.trim(),
    date: document.getElementById('date').value,
    time: document.getElementById('time').value
  };

  if (!formData.table) {
    alert('Please select a table before continuing.');
    return;
  }

  try {
    const response = await fetch('https://script.google.com/macros/s/AKfycbxALplsL1YhvjozZcJrd68-wZ_J8lG0IavP-B9xY26LD8ug7KnTAF5_gOcC3S5Ktp5S/exec', {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(formData)
    });

    const result = await response.text();

    if (result.includes('rejected')) {
      alert('Sorry, this table/time is unavailable.');
      return;
    }

  emailjs.send("Service_Reservations", "Table_Template", {
  name: document.getElementById("name").value,
  email: document.getElementById("email").value,
  phone: document.getElementById("phone").value,
  date: document.getElementById("date").value,
  time: document.getElementById("time").value,
  table: document.getElementById("table").value,
  seats: document.getElementById("seats").value,
  specialRequests: document.getElementById("specialRequests").value,
  to_email: document.getElementById("email").value,   // üëà This ensures it sends to the customer
  reply_to: "bar918malkinsbank@gmail.com"             // üëà Optional: your bar email for replies
}, "aypCqsVVHRqzqReCk")
.then(() => {
  console.log("‚úÖ Email sent successfully!");
})
.catch((error) => {
  console.error("‚ùå EmailJS error:", error);
});

</script>
</body>
</html>

