<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bar918 — Book a table</title>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>emailjs.init('aypCqsVVHRqzqReCk');</script>

<style>
  :root {
    --blue: #012C4E;
    --gold: #EAD292;
    --mah: #4B2E05;
  }

  body {
    font-family: Inter, system-ui, Arial;
    background: transparent;
    margin: 0;
    color: var(--blue);
    -webkit-font-smoothing: antialiased;
  }

  /* ✅ Overlay removed, no more white haze */
  .wrap {
    max-width: 920px;
    margin: 18px auto;
    padding: 18px;
    background: transparent;
    border-radius: 14px;
  }

  h1 {
    margin: 0 0 10px;
    font-size: 1.6rem;
    color: var(--blue);
  }

  .layout {
    display: flex;
    gap: 28px;
    align-items: start;
    position: relative;
    flex-wrap: wrap;
  }

  .divider {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: 20px;
    bottom: 20px;
    width: 6px;
    background: var(--mah);
    border-radius: 3px;
  }

  .section {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    padding: 8px;
  }

  .snug {
    display: flex;
    gap: 14px;
    justify-content: flex-start;
    padding-left: 6px;
    margin-top: 14px;
  }

  /* ✅ Fix: added color: var(--blue) so text is visible */
  .table {
    background: var(--gold);
    color: var(--blue);
    border-radius: 10px;
    padding: 12px 6px;
    text-align: center;
    font-weight: 800;
    cursor: pointer;
    transition: transform .12s, box-shadow .12s, border .12s;
    border: 2px solid transparent;
  }

  .table:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 18px rgba(2, 6, 23, 0.06);
  }

  .table small {
    display: block;
    font-weight: 600;
    font-size: .85rem;
    margin-top: 6px;
  }

  .table.selected {
    background: var(--blue);
    color: var(--gold);
    border-color: var(--gold);
  }

  .table.booked {
    background: #bdbdbd;
    color: #333;
    cursor: not-allowed;
  }

  form {
    margin-top: 18px;
    display: grid;
    gap: 10px;
  }

  label {
    font-weight: 700;
    font-size: .9rem;
  }

  input, select, textarea, button {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    font-size: 15px;
  }

  input[type=date], input[type=time] {
    background: white;
  }

  button {
    background: var(--blue);
    color: var(--gold);
    font-weight: 800;
    border: 0;
    cursor: pointer;
  }

  @media(max-width:900px) {
    .section { grid-template-columns: repeat(2, 1fr); }
    .divider { display: none; }
    .snug { justify-content: center; }
  }
</style>
</head>

<body>
<div class="wrap" aria-live="polite">
  <h1>Bar918 — Book a table</h1>

  <!-- Layout -->
  <div class="layout" role="region" aria-label="Table layout">
    <div class="section" id="leftSection"></div>
    <div class="divider" aria-hidden="true"></div>
    <div class="section" id="rightSection"></div>
  </div>

  <div class="snug" id="snugSection"></div>

  <!-- Booking Form -->
  <form id="bookingForm" autocomplete="off" novalidate>
    <label for="name">Full name</label>
    <input id="name" name="name" type="text" required>

    <label for="email">Email</label>
    <input id="email" name="email" type="email" required>

    <label for="phone">Phone</label>
    <input id="phone" name="phone" type="tel" required>

    <label for="date">Date</label>
    <input id="date" name="date" type="date" required>

    <label for="time">Time</label>
    <input id="time" name="time" type="time" min="10:00" max="20:00" required>

    <label for="guests">Guests</label>
    <select id="guests" name="guests" required>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4" selected>4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>

    <label for="babySeat">Baby seat?</label>
    <select id="babySeat" name="babySeat">
      <option>No</option>
      <option>Yes</option>
    </select>

    <label for="notes">Special requests</label>
    <textarea id="notes" name="notes" rows="3" placeholder="Allergies, celebrations..."></textarea>

    <input id="table" name="table" type="hidden" required>

    <button id="submitBtn" type="submit">Confirm booking</button>
  </form>
</div>

<script>
/* CONFIG */
const WEBHOOK = 'https://script.google.com/macros/s/AKfycbxALplsL1YhvjozZcJrd68-wZ_J8lG0IavP-B9xY26LD8ug7KnTAF5_gOcC3S5Ktp5S/exec';
const EMAILJS_SERVICE = 'Service_Reservations';
const EMAILJS_TEMPLATE = 'Table_Template';
const STAFF_EMAIL = 'bar918.malkinsbank@gmail.com';

/* Table definitions */
const LEFT = [
  {id:7,seats:4},{id:8,seats:4},{id:9,seats:4},
  {id:10,seats:4},{id:11,seats:4},{id:12,seats:4},
  {id:13,seats:4},{id:14,seats:6},{id:15,seats:4}
];
const RIGHT = [
  {id:1,seats:4},{id:2,seats:6},{id:3,seats:4},
  {id:4,seats:4},{id:5,seats:4},{id:6,seats:6}
];
const SNUGS = [{id:'S1',seats:2},{id:'S2',seats:2},{id:'S3',seats:2}];

/* Build UI */
function makeCard(t){
  const d = document.createElement('button');
  d.type='button';
  d.className='table';
  d.dataset.id = t.id;
  d.dataset.seats = t.seats;
  d.innerHTML = `${typeof t.id === 'string' ? t.id : 'Table ' + t.id}<small>${t.seats} seats</small>`;
  d.addEventListener('click', () => {
    if(d.classList.contains('booked')) return;
    document.querySelectorAll('.table').forEach(x=>x.classList.remove('selected'));
    d.classList.add('selected');
    document.getElementById('table').value = t.id;
    const guestsEl = document.getElementById('guests');
    if(!guestsEl.dataset.touched) guestsEl.value = t.seats;
  });
  return d;
}

function renderLayout(){
  const left = document.getElementById('leftSection'),
        right = document.getElementById('rightSection'),
        snug = document.getElementById('snugSection');
  left.innerHTML=''; right.innerHTML=''; snug.innerHTML='';
  LEFT.forEach(t=>left.appendChild(makeCard(t)));
  RIGHT.forEach(t=>right.appendChild(makeCard(t)));
  SNUGS.forEach(t=>snug.appendChild(makeCard(t)));
}
renderLayout();

document.getElementById('guests').addEventListener('change', ()=>document.getElementById('guests').dataset.touched = '1');

function toast(msg){ alert(msg); }

document.getElementById('bookingForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;
  const table = document.getElementById('table').value;
  const guests = document.getElementById('guests').value;
  const babySeat = document.getElementById('babySeat').value;
  const notes = document.getElementById('notes').value.trim();

  if(!table){ return toast('Please select a table'); }

  const booking = {
    name, email, phone, date, time, table, guests,
    contact: (phone ? phone : '') + (email ? (' / ' + email) : ''),
    notes: `Baby seat: ${babySeat}${notes ? ' — ' + notes : ''}`
  };

  try {
    const resp = await fetch(WEBHOOK, {
      method: 'POST',
      headers: {'Content-Type': 'text/plain;charset=utf-8'},
      body: JSON.stringify({ action: 'createBooking', booking })
    });
    const txt = await resp.text();

    if(txt && txt.startsWith('rejected')){
      toast('Sorry — booking unavailable (' + txt.split(':')[1] + ').');
      return;
    }
    if(txt && txt.startsWith('success')){
      await emailjs.send(EMAILJS_SERVICE, EMAILJS_TEMPLATE, {...booking, to_email: booking.email});
      await emailjs.send(EMAILJS_SERVICE, EMAILJS_TEMPLATE, {...booking, to_email: STAFF_EMAIL});
      toast('Booking confirmed — confirmation email sent.');
      e.target.reset();
      document.querySelectorAll('.table').forEach(t=>t.classList.remove('selected'));
      document.getElementById('table').value = '';
      return;
    }
    toast('Unexpected server response: ' + txt);
  } catch (err) {
    console.error(err);
    toast('Network error while saving booking — try again.');
  }
});
</script>
</body>
</html>
